clear
set more off

cd "/Users/maggie/Desktop/Mississippi"

global NCESSchool "/Users/maggie/Desktop/Mississippi/NCES/School"
global NCESDistrict "/Users/maggie/Desktop/Mississippi/NCES/District"
global NCES "/Users/maggie/Desktop/Mississippi/NCES/Cleaned"
global MS "/Users/maggie/Desktop/Mississippi/Missing Schools"

global years 2013 2014 2015 2016 2017 2018 2020

foreach a in $years {
	
	use "${NCESDistrict}/NCES_`a'_District.dta", clear 
	keep if state_fips == 28
	
	rename state_name State
	rename state_location StateAbbrev
	rename state_fips StateFips
	rename ncesdistrictid NCESDistrictID
	rename state_leaid State_leaid
	rename district_agency_type DistrictType
	rename county_name CountyName
	rename county_code CountyCode
	rename lea_name DistName
	
	save "${NCES}/NCES_`a'_District.dta", replace
	
	use "${NCESSchool}/NCES_`a'_School.dta", clear
	keep if state_fips == 28
	
	rename state_name State
	rename state_location StateAbbrev
	rename state_fips StateFips
	rename ncesdistrictid NCESDistrictID
	rename state_leaid State_leaid
	rename charter Charter
	rename county_code CountyCode
	rename ncesschoolid NCESSchoolID
	rename school_type SchoolType
	rename virtual Virtual 
	rename school_level SchoolLevel
	
	save "${NCES}/NCES_`a'_School.dta", replace
	
}

import delimited "${NCESDistrict}/NCES_2021_District.csv", clear
	keep if statefips == 28
	rename state State
	rename stateabbrev StateAbbrev
	rename statefips StateFips
	rename ncesdistrictid NCESDistrictID
	rename state_leaid State_leaid
	rename districttype DistrictType
	rename charter Charter
	rename countyname CountyName
	rename countycode CountyCode
	rename schyear SchYear
	rename distname DistName
	drop if NCESDistrictID == 2800960
save "${NCES}/NCES_2021_District.dta", replace

import delimited "${NCESSchool}/NCES_2021_School.csv", clear
	keep if statefips == 28
	rename state State
	rename stateabbrev StateAbbrev
	rename statefips StateFips
	rename ncesdistrictid NCESDistrictID
	rename state_leaid State_leaid
	rename charter Charter
	rename countycode CountyCode
	rename ncesschoolid NCESSchoolID
	rename schooltype SchoolType
	rename virtual Virtual 
	rename schoollevel SchoolLevel
save "${NCES}/NCES_2021_School.dta", replace

import excel "${MS}/Missing Schools.xlsx", sheet("Missing Schools") firstrow clear
	sort SchName DistName
	quietly by SchName DistName:  gen dup = cond(_N==1,0,_n)
	drop if dup > 1
	drop dup
	sort SchName
	drop if SchName == ""
save "${NCES}/NCES_Schools.dta", replace
